"use strict";(self.webpackChunkdocs_neuralmagic_com=self.webpackChunkdocs_neuralmagic_com||[]).push([[4087],{3328:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>p});var o=n(4848),a=n(8453);const l={},i="OpenAI Compatible Server",r={id:"products/nm-vllm/openai_compatible_server",title:"OpenAI Compatible Server",description:"nm-vllm provides an HTTP server that implements OpenAI's Completions and Chat API.",source:"@site/docs/products/nm-vllm/openai_compatible_server.mdx",sourceDirName:"products/nm-vllm",slug:"/products/nm-vllm/openai_compatible_server",permalink:"/next/products/nm-vllm/openai_compatible_server",draft:!1,unlisted:!1,editUrl:"https://github.com/neuralmagic/docs/tree/main/docs/products/nm-vllm/openai_compatible_server.mdx",tags:[],version:"current",frontMatter:{},sidebar:"autogenerated_docs",previous:{title:"Deploying with Docker",permalink:"/next/products/nm-vllm/deploying_with_docker"},next:{title:"DeepSparse",permalink:"/next/products/deepsparse/"}},s={},p=[{value:"API Reference",id:"api-reference",level:2},{value:"Extra Parameters",id:"extra-parameters",level:2},{value:"Extra Parameters for Chat API",id:"extra-parameters-for-chat-api",level:3},{value:"Extra Parameters for Completions API",id:"extra-parameters-for-completions-api",level:3},{value:"Chat Template",id:"chat-template",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"openai-compatible-server",children:"OpenAI Compatible Server"}),"\n",(0,o.jsxs)(t.p,{children:["nm-vllm provides an HTTP server that implements OpenAI's ",(0,o.jsx)(t.a,{href:"https://platform.openai.com/docs/api-reference/completions",children:"Completions"})," and ",(0,o.jsx)(t.a,{href:"https://platform.openai.com/docs/api-reference/chat",children:"Chat"})," API."]}),"\n",(0,o.jsxs)(t.p,{children:["You can start the server using Python, or using ",(0,o.jsx)(t.a,{href:"./deploying_with_docker",children:"Docker"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"python -m vllm.entrypoints.openai.api_server --model meta-llama/Llama-2-7b-hf --dtype float32 --api-key token-abc123\n"})}),"\n",(0,o.jsx)(t.p,{children:"To call the server, you can use the official OpenAI Python client library, or any other HTTP client."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'from openai import OpenAI\nclient = OpenAI(\n    base_url="http://localhost:8000/v1",\n    api_key="token-abc123",\n)\n\ncompletion = client.chat.completions.create(\n  model="meta-llama/Llama-2-7b-hf",\n  messages=[\n    {"role": "system", "content": "You are a helpful assistant."},\n    {"role": "user", "content": "Hello!"}\n  ]\n)\n\nprint(completion.choices[0].message)\n'})}),"\n",(0,o.jsx)(t.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,o.jsxs)(t.p,{children:["Please see the ",(0,o.jsx)(t.a,{href:"https://platform.openai.com/docs/api-reference",children:"OpenAI API Reference"})," for more information on the API. We support all parameters except:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Chat: ",(0,o.jsx)(t.code,{children:"tools"}),", and ",(0,o.jsx)(t.code,{children:"tool_choice"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Completions: ",(0,o.jsx)(t.code,{children:"suffix"}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"extra-parameters",children:"Extra Parameters"}),"\n",(0,o.jsx)(t.p,{children:"nm-vllm supports a set of parameters that are not part of the OpenAI API.\nIn order to use them, you can pass them as extra parameters in the OpenAI client.\nOr directly merge them into the JSON payload if you are using HTTP call directly."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'completion = client.chat.completions.create(\n  model="meta-llama/Llama-2-7b-hf",\n  messages=[\n    {"role": "system", "content": "You are a helpful assistant."},\n    {"role": "user", "content": "Classify this sentiment: vLLM is wonderful!"}\n  ],\n  extra_body={\n    "guided_choice": ["positive", "negative"]\n  }\n)\n'})}),"\n",(0,o.jsx)(t.h3,{id:"extra-parameters-for-chat-api",children:"Extra Parameters for Chat API"}),"\n",(0,o.jsx)(t.p,{children:"The following sampling parameters are supported."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:"    best_of: Optional[int] = None\n    use_beam_search: Optional[bool] = False\n    top_k: Optional[int] = -1\n    min_p: Optional[float] = 0.0\n    repetition_penalty: Optional[float] = 1.0\n    length_penalty: Optional[float] = 1.0\n    early_stopping: Optional[bool] = False\n    ignore_eos: Optional[bool] = False\n    min_tokens: Optional[int] = 0\n    stop_token_ids: Optional[List[int]] = Field(default_factory=list)\n    skip_special_tokens: Optional[bool] = True\n    spaces_between_special_tokens: Optional[bool] = True\n"})}),"\n",(0,o.jsx)(t.p,{children:"The following extra parameters are supported:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'    echo: Optional[bool] = Field(\n        default=False,\n        description=(\n            "If true, the new message will be prepended with the last message "\n            "if they belong to the same role."),\n    )\n    add_generation_prompt: Optional[bool] = Field(\n        default=True,\n        description=\n        ("If true, the generation prompt will be added to the chat template. "\n         "This is a parameter used by chat template in tokenizer config of the "\n         "model."),\n    )\n    include_stop_str_in_output: Optional[bool] = Field(\n        default=False,\n        description=(\n            "Whether to include the stop string in the output. "\n            "This is only applied when the stop or stop_token_ids is set."),\n    )\n    guided_json: Optional[Union[str, dict, BaseModel]] = Field(\n        default=None,\n        description=("If specified, the output will follow the JSON schema."),\n    )\n    guided_regex: Optional[str] = Field(\n        default=None,\n        description=(\n            "If specified, the output will follow the regex pattern."),\n    )\n    guided_choice: Optional[List[str]] = Field(\n        default=None,\n        description=(\n            "If specified, the output will be exactly one of the choices."),\n    )\n    guided_grammar: Optional[str] = Field(\n        default=None,\n        description=(\n            "If specified, the output will follow the context free grammar."),\n    )\n'})}),"\n",(0,o.jsx)(t.h3,{id:"extra-parameters-for-completions-api",children:"Extra Parameters for Completions API"}),"\n",(0,o.jsx)(t.p,{children:"The following sampling parameters are supported."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:"    use_beam_search: Optional[bool] = False\n    top_k: Optional[int] = -1\n    min_p: Optional[float] = 0.0\n    repetition_penalty: Optional[float] = 1.0\n    length_penalty: Optional[float] = 1.0\n    early_stopping: Optional[bool] = False\n    stop_token_ids: Optional[List[int]] = Field(default_factory=list)\n    ignore_eos: Optional[bool] = False\n    min_tokens: Optional[int] = 0\n    skip_special_tokens: Optional[bool] = True\n    spaces_between_special_tokens: Optional[bool] = True\n    truncate_prompt_tokens: Optional[conint(ge=1)] = None\n"})}),"\n",(0,o.jsx)(t.p,{children:"The following extra parameters are supported:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'    include_stop_str_in_output: Optional[bool] = Field(\n        default=False,\n        description=(\n            "Whether to include the stop string in the output. "\n            "This is only applied when the stop or stop_token_ids is set."),\n    )\n    response_format: Optional[ResponseFormat] = Field(\n        default=None,\n        description=\n        ("Similar to chat completion, this parameter specifies the format of "\n         "output. Only {\'type\': \'json_object\'} or {\'type\': \'text\' } is "\n         "supported."),\n    )\n    guided_json: Optional[Union[str, dict, BaseModel]] = Field(\n        default=None,\n        description=("If specified, the output will follow the JSON schema."),\n    )\n    guided_regex: Optional[str] = Field(\n        default=None,\n        description=(\n            "If specified, the output will follow the regex pattern."),\n    )\n    guided_choice: Optional[List[str]] = Field(\n        default=None,\n        description=(\n            "If specified, the output will be exactly one of the choices."),\n    )\n    guided_grammar: Optional[str] = Field(\n        default=None,\n        description=(\n            "If specified, the output will follow the context free grammar."),\n    )\n'})}),"\n",(0,o.jsx)(t.h2,{id:"chat-template",children:"Chat Template"}),"\n",(0,o.jsx)(t.p,{children:"In order for the language model to support chat protocol, nm-vllm requires the model to include\na chat template in its tokenizer configuration. The chat template is a Jinja2 template that\nspecifies how are roles, messages, and other chat-specific tokens are encoded in the input."}),"\n",(0,o.jsxs)(t.p,{children:["An example chat template for ",(0,o.jsx)(t.code,{children:"meta-llama/Llama-2-7b-chat-hf"})," can be found ",(0,o.jsx)(t.a,{href:"https://huggingface.co/meta-llama/Llama-2-7b-chat-hf/blob/09bd0f49e16738cdfaa6e615203e126038736eb0/tokenizer_config.json#L12",children:"here"})]}),"\n",(0,o.jsxs)(t.p,{children:["Some models do not provide a chat template even though they are instruction/chat fine-tuned. For those model,\nyou can manually specify their chat template in the ",(0,o.jsx)(t.code,{children:"--chat-template"})," parameter with the file path to the chat\ntemplate, or the template in string form. Without a chat template, the server will not be able to process chat\nand all chat requests will error."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"python -m vllm.entrypoints.openai.api_server \\\n  --model ... \\\n  --chat-template ./path-to-chat-template.jinja\n"})}),"\n",(0,o.jsxs)(t.p,{children:["vLLM community provides a set of chat templates for popular models. You can find them in the examples\ndirectory ",(0,o.jsx)(t.a,{href:"https://github.com/vllm-project/vllm/tree/main/examples/",children:"here"})]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var o=n(6540);const a={},l=o.createContext(a);function i(e){const t=o.useContext(l);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(l.Provider,{value:t},e.children)}}}]);